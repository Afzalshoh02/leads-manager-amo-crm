# Leads Manager

Приложение для управления лидами из AMO CRM с использованием API. Разработано с применением архитектуры MVC, предоставляет удобный интерфейс для фильтрации, сортировки и просмотра лидов.

## Содержание
1. [Требования](#требования)
2. [Установка](#установка)
3. [Настройка](#настройка)
4. [Авторизация и получение токенов](#авторизация-и-получение-токенов)
5. [Основные функции](#основные-функции)
6. [Структура проекта](#структура-проекта)
7. [Работа с API AMO CRM](#работа-с-api-amo-crm)
8. [Тестирование](#тестирование)
9. [Дополнительная информация](#дополнительная-информация)

---

## Требования

- PHP >= 8.0
- Composer
- Web-сервер (например, Apache или Nginx)
- MySQL или другая СУБД (если используется база данных)
- Аккаунт в AMO CRM с правами доступа к API
- Установленные зависимости (см. `composer.json`)

---

## Установка

1. **Клонирование репозитория**
   ```bash
    git clone https://github.com/Afzalshoh02/leads-manager-amo-crm.git
   ```
   или через SSH:
   ```bash
    git clone git@github.com:Afzalshoh02/leads-manager-amo-crm.git
   ```
   ```bash
   cd leads-manager-amo-crm
   ```

2. **Установка зависимостей**
   Убедитесь, что у вас установлен Composer, затем выполните:
   ```bash
   composer install
   ```

3. **Настройка окружения**
    - Скопируйте файл `.env.example` в `.env`:
      ```bash
      cp .env.example .env
      ```
    - Отредактируйте `.env`, указав параметры подключения к базе данных (если используется) и данные AMO CRM (см. [Настройка](#настройка)).

---

## Настройка

1. **Конфигурация AMO CRM**
    - В `.env` укажите следующие параметры:
      ```
      AMO_BASE_DOMAIN=your-subdomain.amocrm.ru
      AMO_CLIENT_ID=your-client-id
      AMO_CLIENT_SECRET=your-client-secret
      AMO_REDIRECT_URI=http://localhost:8000/auth/callback
      ```
    - Эти данные можно получить в разделе интеграций AMO CRM.

2. **Конфигурация базы данных (опционально)**
    - Если приложение использует базу данных:
      ```
      DB_CONNECTION=mysql
      DB_HOST=127.0.0.1
      DB_PORT=3306
      DB_DATABASE=leads_manager
      DB_USERNAME=root
      DB_PASSWORD=your-password
      ```

3. **Генерация ключа приложения**
   ```bash
   php artisan key:generate
   ```

---

## Авторизация и получение токенов

Приложение использует OAuth 2.0 для авторизации в AMO CRM. Процесс:

4. Регистрация и создание интеграции в AMO CRM
   Чтобы получить данные для настройки AMO CRM API (например, AMO_CLIENT_ID, AMO_CLIENT_SECRET, AMO_REDIRECT_URI, и AMO_BASE_DOMAIN), выполните следующие шаги:

Зарегистрируйтесь на AMO CRM:

Перейдите на AMO CRM и создайте аккаунт, если у вас его еще нет.

Создание интеграции через AMO Market:

Перейдите в раздел AMO Market (иногда доступно через интерфейс вашего аккаунта).

Создайте новую интеграцию, выбрав нужные параметры для приложения.

После создания интеграции вы получите Client ID, Client Secret, и Redirect URI.

Получение данных для AMO CRM API: После создания интеграции, скопируйте следующие данные:

Client ID (AMO_CLIENT_ID)

Client Secret (AMO_CLIENT_SECRET)

Redirect URI (AMO_REDIRECT_URI)

AMO Base Domain (AMO_BASE_DOMAIN) — это домен вашего аккаунта AMO CRM (например, your-company-name.amocrm.ru).

Заполнение файла .env: Вставьте полученные данные в файл .env, который находится в корне проекта.

Пример:

dotenv
Копировать
Редактировать
AMO_CLIENT_ID=your-client-id
AMO_CLIENT_SECRET=your-client-secret
AMO_REDIRECT_URI=http://localhost:8000/auth/callback
AMO_BASE_DOMAIN=your-company-name.amocrm.ru
---

## Основные функции

- **Фильтрация лидов**: По дате создания/обновления (`from_date`, `to_date`).
- **Сортировка**: По возрастанию/убыванию даты (`sort=asc/desc`).
- **Пагинация**: Выбор количества элементов на странице (`limit=10/25/50`).
- **Просмотр данных**: Отображение имени, статуса, контакта и даты обновления лида.
- **Адаптивный интерфейс**: Современный дизайн с использованием Bootstrap 5.

---

## Миграции 

```bash
php artisan migrate
```

---

## Тестирование

Приложение включает Feature-тесты для проверки основных функциональных возможностей. Для запуска тестов выполните:

```bash
php artisan test
```

Тесты покрывают следующие сценарии:
- Авторизация и аутентификация
- Фильтрация и сортировка лидов
- Пагинация
- Обработка ошибок API
- Валидация входных параметров

Для запуска конкретного тестового класса:
```bash
php artisan test --filter=AmoCrmServiceTest
```

---

## Работа с API AMO CRM

Приложение взаимодействует с AMO CRM через REST API:
- Получение списка лидов (`/api/v4/leads`)
- Фильтрация по параметрам
- Обработка пагинации
- Обновление токенов доступа

---

## Запуск приложения
**Запуск локального сервера**
   ```bash
   php artisan serve
   ```
